<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Reported Sites</title>
    <link rel="stylesheet" href="reports-styles.css" />
  </head>
  <body>
    <h1>Reported Waste Sites</h1>
    <div id="reports-container">
      <p>Loading reports...</p>
    </div>

    <script type="module">
      import { getAllReports } from "./db.js";

      document.addEventListener("DOMContentLoaded", async () => {
        const reportsContainer = document.getElementById("reports-container");

        try {
          const reports = await getAllReports();

          console.log(reports);

          if (reports.length === 0) {
            reportsContainer.innerHTML = "<p>No reports available.</p>";
          } else {
            reportsContainer.innerHTML = ""; // Clear the loading message

            reports.forEach((report) => {
              const reportDiv = document.createElement("div");
              reportDiv.classList.add("report");

              // Add details of each report
              reportDiv.innerHTML = `
              <h3>${report.location}</h3>
              <p><strong>Description:</strong> ${report.description}</p>
              <p><strong>Waste Type:</strong> ${report.wasteType.join(", ")}</p>
              <p><strong>Urgency:</strong> ${report.urgency}</p>
              <p><strong>Reported On:</strong> ${new Date(
                report.timestamp
              ).toLocaleString()}</p>
              <p><strong>Contact:</strong> ${
                report.anonymous
                  ? "Anonymous"
                  : `${report.contact.email}, ${report.contact.phone}`
              }</p>
              <div>
                <strong>Images:</strong>
                <div class="images-container">
                  ${report.images
                    .map(
                      (img) =>
                        `<img src="${img}" alt="Report Image" class="report-image" />`
                    )
                    .join("")}
                </div>
              </div>
            `;

              reportsContainer.appendChild(reportDiv);
            });
          }
        } catch (err) {
          console.error("Error fetching reports:", err);
          reportsContainer.innerHTML = "<p>Failed to load reports.</p>";
        }
      });
    </script>
  </body>
</html>
